# Feature Specification: 노트 관리 (Note Management)

**Feature Branch**: `002-note-management`
**Created**: 2026-01-13
**Status**: Draft
**Input**: User description: "Phase 2: 노트 관리 - 발행 상태 대시보드 및 일괄 동기화"

## Clarifications

### Session 2026-01-13

- Q: 발행 상태 변경 감지 방식은? → A: 대시보드 열 때 실시간 계산 (정확하지만 노트 수에 따라 느려질 수 있음)
- Q: 대시보드 노트 그룹화 표시 방식은? → A: 탭 방식 (신규/수정됨/삭제필요/최신 탭으로 분리, 한 번에 하나의 상태만 표시)
- Q: 일괄 작업 실행 방식은? → A: 순차 처리 (한 번에 하나씩, 단순하고 레이트 리밋 안전)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 발행 상태 확인 (Priority: P1)

사용자는 자신의 Obsidian vault에서 어떤 노트가 발행되었고, 어떤 노트가 업데이트가 필요한지 한눈에 파악하고 싶습니다. 대시보드 모달을 열어 모든 발행 대상 노트의 상태를 확인할 수 있습니다.

**Why this priority**: 사용자가 발행 상태를 파악할 수 없으면 어떤 노트를 발행해야 하는지 알 수 없습니다. 이는 모든 일괄 처리 기능의 전제 조건입니다.

**Independent Test**: 대시보드를 열어 노트 목록과 각 노트의 상태(신규/수정됨/삭제 필요/최신)를 확인하는 것만으로 가치를 제공합니다.

**Acceptance Scenarios**:

1. **Given** vault에 `publish: true` 프론트매터가 있는 노트가 5개 있고 그 중 2개만 GitHub에 발행된 상태, **When** 사용자가 대시보드를 열면, **Then** 3개는 "신규"로, 2개는 "최신 상태"로 표시됩니다.
2. **Given** 이미 발행된 노트가 로컬에서 수정된 상태, **When** 사용자가 대시보드를 열면, **Then** 해당 노트는 "업데이트 필요"로 표시됩니다.
3. **Given** GitHub에 발행된 노트가 로컬에서 삭제되거나 `publish: false`로 변경된 상태, **When** 사용자가 대시보드를 열면, **Then** 해당 노트는 "삭제 필요"로 표시됩니다.

---

### User Story 2 - 선택적 일괄 발행 (Priority: P2)

사용자는 대시보드에서 여러 노트를 선택하여 한 번에 발행하거나 업데이트하고 싶습니다. 개별 노트마다 발행 명령을 실행하는 것은 번거롭습니다.

**Why this priority**: 상태 확인 후 자연스럽게 이어지는 행동입니다. 상태 확인만으로는 실질적인 작업을 수행할 수 없습니다.

**Independent Test**: 대시보드에서 3개의 노트를 선택하고 "발행" 버튼을 눌러 모두 발행되는 것을 확인합니다.

**Acceptance Scenarios**:

1. **Given** 대시보드에 "신규" 상태인 노트 3개가 표시된 상태, **When** 사용자가 2개를 선택하고 "발행" 버튼을 클릭하면, **Then** 선택된 2개 노트만 GitHub에 발행됩니다.
2. **Given** 대시보드에 "업데이트 필요" 노트 2개가 있는 상태, **When** 사용자가 모두 선택하고 "발행" 버튼을 클릭하면, **Then** 해당 노트들의 변경사항이 GitHub에 반영됩니다.
3. **Given** 사용자가 아무 노트도 선택하지 않은 상태, **When** "발행" 버튼을 클릭하면, **Then** 동작하지 않고 선택이 필요하다는 안내 메시지가 표시됩니다.

---

### User Story 3 - 선택적 일괄 삭제 (Priority: P3)

사용자는 더 이상 발행하지 않을 노트들을 GitHub에서 일괄 삭제하고 싶습니다.

**Why this priority**: 삭제는 발행보다 덜 빈번하고, 잘못 실행하면 복구가 어려워 신중한 처리가 필요합니다.

**Independent Test**: 대시보드에서 "삭제 필요" 노트 2개를 선택하고 삭제를 실행하여 GitHub에서 제거되는 것을 확인합니다.

**Acceptance Scenarios**:

1. **Given** 대시보드에 "삭제 필요" 노트 2개가 있는 상태, **When** 사용자가 1개를 선택하고 "삭제" 버튼을 클릭하면, **Then** 확인 모달이 표시됩니다.
2. **Given** 확인 모달이 표시된 상태, **When** 사용자가 "확인"을 클릭하면, **Then** 선택된 노트가 GitHub에서 삭제됩니다.
3. **Given** 확인 모달이 표시된 상태, **When** 사용자가 "취소"를 클릭하면, **Then** 아무 것도 삭제되지 않고 대시보드로 돌아갑니다.

---

### User Story 4 - 전체 동기화 (Priority: P4)

사용자는 한 번의 클릭으로 모든 노트를 동기화하고 싶습니다. 신규 노트는 발행하고, 수정된 노트는 업데이트하고, 삭제가 필요한 노트는 제거합니다.

**Why this priority**: 편의 기능이지만, 대량의 변경사항이 한 번에 적용되어 의도치 않은 결과를 초래할 수 있으므로 개별 기능들이 안정화된 후 제공합니다.

**Independent Test**: 전체 동기화 버튼을 눌러 모든 발행 대상 노트가 GitHub와 일치하는지 확인합니다.

**Acceptance Scenarios**:

1. **Given** vault에 신규 2개, 수정됨 1개, 삭제 필요 1개 노트가 있는 상태, **When** 사용자가 "전체 동기화" 버튼을 클릭하면, **Then** 삭제에 대한 확인 모달이 먼저 표시됩니다.
2. **Given** 전체 동기화 확인 후, **When** 동기화가 완료되면, **Then** 모든 노트가 "최신 상태"로 표시됩니다.
3. **Given** 동기화 중 일부 노트에서 오류가 발생한 상태, **When** 동기화가 완료되면, **Then** 실패한 노트 목록과 오류 메시지가 표시되고, 성공한 노트는 정상 처리됩니다.

---

### Edge Cases

- 대시보드를 여는 동안 다른 사용자가 GitHub 리포지토리를 수정한 경우 어떻게 처리하는가? (로컬 우선 정책 적용)
- 동기화 중 네트워크가 끊긴 경우 어떻게 처리하는가? (진행 중이던 작업은 롤백 없이 중단, 이미 완료된 작업은 유지)
- vault에 발행 대상 노트가 1000개 이상인 경우 대시보드 성능은 어떻게 보장하는가? (페이지네이션 또는 가상 스크롤 적용)
- 발행 중 파일 내용이 로컬에서 변경되면 어떻게 처리하는가? (발행 시작 시점의 내용으로 발행)

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 vault 내 모든 `publish: true` 노트를 식별하고 목록화해야 합니다.
- **FR-002**: 시스템은 대시보드를 열 때 각 노트의 발행 상태를 실시간으로 계산해야 합니다 (콘텐츠 해시 비교 방식): 신규(GitHub에 없음), 업데이트 필요(로컬이 더 최신), 삭제 필요(로컬에서 제거됨 또는 publish: false), 최신 상태(동일)
- **FR-003**: 시스템은 대시보드 모달 UI를 탭 방식으로 구성하여 발행 상태별(신규/수정됨/삭제필요/최신)로 노트를 분리 표시해야 합니다.
- **FR-004**: 사용자는 대시보드에서 체크박스로 여러 노트를 선택할 수 있어야 합니다.
- **FR-005**: 사용자는 선택된 노트들을 일괄 발행할 수 있어야 합니다 (순차 처리 방식).
- **FR-006**: 사용자는 선택된 노트들을 일괄 삭제할 수 있어야 합니다 (순차 처리 방식).
- **FR-007**: 시스템은 삭제 작업 전 확인 모달을 표시해야 합니다.
- **FR-008**: 시스템은 전체 동기화 기능을 제공해야 합니다(신규 발행 + 업데이트 + 삭제를 한 번에).
- **FR-009**: 시스템은 일괄 작업의 진행 상황을 프로그레스 바로 표시해야 합니다.
- **FR-010**: 시스템은 일괄 작업 완료 후 성공/실패 결과 요약을 표시해야 합니다.
- **FR-011**: 대시보드는 커맨드 팔레트를 통해 접근할 수 있어야 합니다.

### Key Entities

- **발행 대상 노트 (Publishable Note)**: vault 내 `publish: true` 프론트매터가 있는 마크다운 파일. 속성: 파일 경로, 제목, 마지막 수정 시간, 발행 상태
- **발행 상태 (Publish Status)**: 노트의 현재 동기화 상태를 나타내는 분류. 값: 신규(new), 수정됨(modified), 삭제 필요(pending_delete), 최신(up_to_date)
- **발행 기록 (Publish Record)**: GitHub에 발행된 노트의 메타데이터. 속성: 로컬 파일 경로, GitHub 파일 경로, 마지막 발행 시간, 콘텐츠 해시

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 대시보드를 열어 5초 이내에 전체 발행 상태를 파악할 수 있습니다.
- **SC-002**: 100개의 노트를 일괄 발행하는 작업이 5분 이내에 완료됩니다.
- **SC-003**: 사용자의 90%가 첫 시도에서 원하는 노트를 선택하고 발행할 수 있습니다.
- **SC-004**: 일괄 작업 중 발생한 오류에 대해 사용자가 명확한 원인과 해결 방법을 이해할 수 있습니다.
- **SC-005**: 대시보드를 통한 일괄 발행이 개별 발행 대비 작업 시간을 70% 이상 단축합니다.

## Assumptions

- 발행 기록은 Obsidian 플러그인 데이터 저장소(data.json)에 저장됩니다.
- 콘텐츠 해시는 변환 후 콘텐츠를 기준으로 계산합니다(원본 마크다운이 아닌 Quartz 호환 형식).
- 대시보드 노트 목록은 수정 시간 기준 내림차순으로 기본 정렬됩니다.
- "삭제 필요" 판단은 로컬 vault의 상태만 기준으로 합니다(GitHub에서 수동 삭제된 파일은 "신규"로 표시될 수 있음).
